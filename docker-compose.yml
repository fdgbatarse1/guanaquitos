version: "3"
services:
  frontend:
    container_name: frontend
    build:
      context: ./frontend
    restart: unless-stopped
    env_file: ./frontend/.env
    volumes:
      - ./frontend/public:/frontend/app/public
      - ./frontend/src:/frontend/app/src
      - ./frontend/.env:/frontend/app/.env
      - ./frontend/.eslintrc.json:/frontend/app/.eslintrc.json
      - ./frontend/.gitignore:/frontend/app/.gitignore
      - ./frontend/next.config.mjs:/frontend/app/next.config.mjs
      - ./frontend/package-lock.json:/frontend/package-lock.json
      - ./frontend/package.json:/frontend/package.json
      - ./frontend/postcss.config.js:/frontend/postcss.config.js
      - ./frontend/README.md:/frontend/README.md
      - ./frontend/tailwind.config.ts:/frontend/tailwind.config.ts
      - ./frontend/tsconfig.json:/frontend/tsconfig.json
    ports:
      - "3000:3000"
    networks:
      - guanaquitos
    depends_on:
      - backend

  backend:
    container_name: backend
    build:
      context: ./backend
    restart: unless-stopped
    env_file: ./backend/.env
    volumes:
      - ./backend/config:/backend/app/config
      - ./backend/src:/backend/app/src
      - ./backend/package.json:/backend/package.json
      - ./backend/package-lock.json:/backend/package-lock.json
      - ./backend/.env:/backend/app/.env
      - ./backend/public/uploads:/backend/app/public/uploads
    ports:
      - "1337:1337"
    networks:
      - guanaquitos
    depends_on:
      - postgres

  postgres:
    container_name: postgres
    restart: unless-stopped
    env_file: ./postgres.env
    image: postgres:16.1-alpine3.18
    volumes:
      - postgres-data:/var/lib/postgresql/data/ #using a volume
      - ./data/postgres:/var/lib/postgresql/data/ # if you want to use a bind folder
    ports:
      - "5432:5432"
    networks:
      - guanaquitos

  chroma:
    container_name: chroma
    restart: unless-stopped
    env_file: ./chroma.env
    image: chromadb/chroma
    volumes:
      - chroma-data:/chroma/chroma/
      - ./data/chroma:/chroma/chroma/
    ports:
      - "8000:8000"
    networks:
      - guanaquitos
  
  npm:
    image: node:lts-alpine
    working_dir: /frontend/app
    volumes:
      - ./frontend:/frontend/app
    entrypoint: ["npm"]

volumes:
  postgres-data:
  chroma-data:

networks:
  guanaquitos:
    name: guanaquitos
    driver: bridge
